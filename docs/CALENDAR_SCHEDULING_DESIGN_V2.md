# ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼äºˆå®šå…¥åŠ›æ©Ÿèƒ½ è¨­è¨ˆæ›¸ V2ï¼ˆæ”¹è‰¯ç‰ˆï¼‰

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åæ˜ 

### æ–°è¦è¦ä»¶
1. âœ… **è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¯¾å¿œ**: ä»•äº‹ç”¨ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç”¨ãªã©ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆ
2. âœ… **è¦ªã‚¿ã‚¹ã‚¯ã®ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°**: è¦ªã‚’ãƒ‰ãƒ­ãƒƒãƒ—â†’å­ã‚¿ã‚¹ã‚¯ã‚‚å…¨ã¦åæ˜ 
3. âœ… **é‡è¤‡é˜²æ­¢**: åŒã˜ã‚¿ã‚¹ã‚¯ã‚’2å›äºˆå®šã«å…¥ã‚Œãªã„ï¼ˆIDç®¡ç†ï¼‰
4. âœ… **å®Œå…¨åŒæ–¹å‘åŒæœŸ**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸Šã§ã®å¤‰æ›´ãŒã‚¿ã‚¹ã‚¯ã«å³åº§ã«åæ˜ 

---

## 1. è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¯¾å¿œ

### 1.1 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é¸æŠUI

**å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ [âœ“] ä»•äº‹    [âœ“] ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ  [ ] å®¶æ— â”‚  â† ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é¸æŠ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  [ä»Šé€±â–¼]                    [è¨­å®š]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœˆ25  ç«26  æ°´27  æœ¨28  é‡‘29                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”               â”‚
â”‚ â”‚ğŸŸ¦ğŸŸ¦â”‚ğŸŸ£ğŸŸ£â”‚    â”‚    â”‚ğŸŸ¦ğŸŸ¦â”‚ 9:00          â”‚
â”‚ â”‚ä»•äº‹â”‚MTGâ”‚    â”‚    â”‚æŒ¯è¿”â”‚               â”‚
â”‚ â”‚    â”‚ğŸŸ¢ğŸŸ¢â”‚    â”‚    â”‚    â”‚               â”‚  â† ğŸŸ¦ä»•äº‹ ğŸŸ£ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ
â”‚ â”‚    â”‚ã‚¸ãƒ â”‚    â”‚    â”‚    â”‚               â”‚     ğŸŸ¢å®¶æ—
â”‚ â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

#### user_calendar_settings ãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ
```sql
ALTER TABLE user_calendar_settings ADD COLUMN IF NOT EXISTS calendars JSONB;

-- ä¾‹:
{
  "calendars": [
    {
      "id": "primary",
      "name": "ä»•äº‹",
      "color": "#1E88E5",
      "enabled": true,
      "is_default": true
    },
    {
      "id": "private@gmail.com",
      "name": "ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ",
      "color": "#8E24AA",
      "enabled": true,
      "is_default": false
    },
    {
      "id": "family@group.calendar.google.com",
      "name": "å®¶æ—",
      "color": "#43A047",
      "enabled": false,
      "is_default": false
    }
  ]
}
```

#### tasks ãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ
```sql
ALTER TABLE tasks ADD COLUMN IF NOT EXISTS target_calendar_id TEXT DEFAULT 'primary';

-- ã‚¿ã‚¹ã‚¯ã”ã¨ã«ã©ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å…¥ã‚Œã‚‹ã‹ã‚’ä¿å­˜
-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ 'primary' (ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼)
```

### 1.3 API: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒªã‚¹ãƒˆå–å¾—

```typescript
// GET /api/calendar/list
export async function GET(request: NextRequest) {
  const { calendar } = await getCalendarClient(userId);

  // Googleã‹ã‚‰å…¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—
  const response = await calendar.calendarList.list();

  const calendars = response.data.items?.map(cal => ({
    id: cal.id,
    name: cal.summary,
    color: cal.backgroundColor,
    accessRole: cal.accessRole, // owner, writer, reader
    primary: cal.primary || false
  })) || [];

  // user_calendar_settingsã«ä¿å­˜
  await supabase
    .from('user_calendar_settings')
    .update({ calendars })
    .eq('user_id', userId);

  return NextResponse.json({ calendars });
}
```

### 1.4 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é¸æŠUI

**è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¨­å®š                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  è¡¨ç¤ºã™ã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼:                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [âœ“] ğŸŸ¦ ä»•äº‹ (primary)              â”‚  â”‚
â”‚  â”‚     ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: [â—]                â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ [âœ“] ğŸŸ£ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ                â”‚  â”‚
â”‚  â”‚     ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: [ ]                â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ [ ] ğŸŸ¢ å®¶æ—ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼              â”‚  â”‚
â”‚  â”‚     ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: [ ]                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚  æ–°è¦ã‚¿ã‚¹ã‚¯ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼:        â”‚
â”‚  [ä»•äº‹ â–¼]                               â”‚
â”‚                                          â”‚
â”‚  [ã‚­ãƒ£ãƒ³ã‚»ãƒ«]              [ä¿å­˜]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.5 ã‚¿ã‚¹ã‚¯ä½œæˆæ™‚ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é¸æŠ

**QuickScheduleModalæ”¹è‰¯ç‰ˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Œè³‡æ–™ä½œæˆã€ã‚¿ã‚¹ã‚¯ã®äºˆå®šã‚’è¨­å®š                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ğŸŸ¦ ä»•äº‹ (primary)      [â–¼]     â”‚  â† NEW!    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                 â”‚
â”‚  ğŸ“… æ—¥ä»˜æ™‚åˆ»                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ 2026å¹´1æœˆ27æ—¥(æœˆ) 14:00        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                 â”‚
â”‚  â±ï¸ æ‰€è¦æ™‚é–“                                     â”‚
â”‚  [ 30åˆ† ] [ 1æ™‚é–“ ] [ 2æ™‚é–“ ] [ ã‚«ã‚¹ã‚¿ãƒ  ]     â”‚
â”‚                                                 â”‚
â”‚  [ ã‚­ãƒ£ãƒ³ã‚»ãƒ« ]              [ äºˆå®šã‚’è¨­å®š ]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. è¦ªã‚¿ã‚¹ã‚¯ã®ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°

### 2.1 ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

**ã‚·ãƒŠãƒªã‚ª**:
```
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨ˆç”»
â”œâ”€ è¦ä»¶å®šç¾© (2h)
â”œâ”€ è¨­è¨ˆ (3h)
â”‚  â”œâ”€ DBè¨­è¨ˆ (1h)
â”‚  â””â”€ APIè¨­è¨ˆ (2h)
â””â”€ å®Ÿè£… (5h)
   â”œâ”€ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (3h)
   â””â”€ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (2h)
```

**ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ**:
ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨ˆç”»ã€ã‚¿ã‚¹ã‚¯ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æœˆæ›œ9:00ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
```
æœˆæ›œ 9:00-11:00  è¦ä»¶å®šç¾©
æœˆæ›œ 11:00-14:00 è¨­è¨ˆ
    â”” 11:00-12:00 DBè¨­è¨ˆ
    â”” 12:00-14:00 APIè¨­è¨ˆ
æœˆæ›œ 14:00-19:00 å®Ÿè£…
    â”” 14:00-17:00 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    â”” 17:00-19:00 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
```

### 2.2 ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ : å­ã‚¿ã‚¹ã‚¯å±•é–‹

```typescript
async function scheduleTaskWithChildren(
  taskId: string,
  startTime: Date,
  calendarId: string
) {
  const task = await getTaskById(taskId);
  const children = await getChildTasks(taskId);

  let currentTime = startTime;
  const scheduledTasks: ScheduledTask[] = [];

  // è¦ªã‚¿ã‚¹ã‚¯ã«å­ã‚¿ã‚¹ã‚¯ãŒã‚ã‚‹å ´åˆ
  if (children.length > 0) {
    // å­ã‚¿ã‚¹ã‚¯ã‚’é †ç•ªã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    for (const child of children) {
      const childDuration = child.estimated_time || 60; // åˆ†
      const childEnd = new Date(currentTime.getTime() + childDuration * 60000);

      // å­ã‚¿ã‚¹ã‚¯ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
      await scheduleTask(child.id, currentTime, childEnd, calendarId);
      scheduledTasks.push({
        taskId: child.id,
        start: currentTime,
        end: childEnd
      });

      // å­«ã‚¿ã‚¹ã‚¯ãŒã‚ã‚‹å ´åˆã¯å†å¸°çš„ã«å‡¦ç†
      const grandChildren = await getChildTasks(child.id);
      if (grandChildren.length > 0) {
        const grandScheduled = await scheduleTaskWithChildren(
          child.id,
          currentTime,
          calendarId
        );
        scheduledTasks.push(...grandScheduled);
      }

      currentTime = childEnd;
    }

    // è¦ªã‚¿ã‚¹ã‚¯è‡ªä½“ã¯ scheduled_at ã‚’è¨­å®šã—ãªã„ï¼ˆã¾ãŸã¯æœ€åˆã®å­ã®æ™‚é–“ï¼‰
    await updateTask(taskId, {
      scheduled_at: startTime.toISOString(),
      estimated_time: 0, // è¦ªã¯è‡ªå‹•é›†è¨ˆ
      target_calendar_id: calendarId
    });

  } else {
    // å­ã‚¿ã‚¹ã‚¯ãŒãªã„å ´åˆã¯é€šå¸¸é€šã‚Šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    const duration = task.estimated_time || 60;
    const endTime = new Date(startTime.getTime() + duration * 60000);
    await scheduleTask(taskId, startTime, endTime, calendarId);
    scheduledTasks.push({
      taskId: task.id,
      start: startTime,
      end: endTime
    });
  }

  return scheduledTasks;
}
```

### 2.3 UI: ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ç¢ºèª

**ãƒ‰ãƒ­ãƒƒãƒ—å¾Œã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¦ªã‚¿ã‚¹ã‚¯ã‚’ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨ˆç”»ã€ã¨ãã®å­ã‚¿ã‚¹ã‚¯3ä»¶ã‚’      â”‚
â”‚  1/27(æœˆ) 9:00ã‹ã‚‰é †ç•ªã«äºˆå®šã—ã¾ã™ã€‚         â”‚
â”‚                                              â”‚
â”‚  äºˆå®šä¸€è¦§:                                   â”‚
â”‚  â”œâ”€ 9:00-11:00   è¦ä»¶å®šç¾© (2h)             â”‚
â”‚  â”œâ”€ 11:00-14:00  è¨­è¨ˆ (3h)                 â”‚
â”‚  â”‚  â”œâ”€ 11:00-12:00  DBè¨­è¨ˆ (1h)           â”‚
â”‚  â”‚  â””â”€ 12:00-14:00  APIè¨­è¨ˆ (2h)          â”‚
â”‚  â””â”€ 14:00-19:00  å®Ÿè£… (5h)                 â”‚
â”‚     â”œâ”€ 14:00-17:00  ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (3h)   â”‚
â”‚     â””â”€ 17:00-19:00  ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (2h)     â”‚
â”‚                                              â”‚
â”‚  ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼: ğŸŸ¦ ä»•äº‹                         â”‚
â”‚                                              â”‚
â”‚  âš ï¸ ã“ã®æ™‚é–“å¸¯ã«æ—¢å­˜äºˆå®šãŒã‚ã‚Šã¾ã™:           â”‚
â”‚  â€¢ 12:30-13:00  ãƒ©ãƒ³ãƒMTG                   â”‚
â”‚                                              â”‚
â”‚  [ æ™‚é–“èª¿æ•´ ]  [ ã‚­ãƒ£ãƒ³ã‚»ãƒ« ]  [ äºˆå®šè¨­å®š ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. é‡è¤‡é˜²æ­¢æ©Ÿèƒ½

### 3.1 ç¾çŠ¶ã®èª²é¡Œ

**å•é¡Œ**: åŒã˜ã‚¿ã‚¹ã‚¯ã‚’ä½•åº¦ã‚‚ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã¨ã€é‡è¤‡ã—ãŸäºˆå®šãŒä½œæˆã•ã‚Œã‚‹

### 3.2 è§£æ±ºç­–: google_event_id ã«ã‚ˆã‚‹ç®¡ç†

#### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```typescript
// ã‚¿ã‚¹ã‚¯ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
async function scheduleTask(
  taskId: string,
  startTime: Date,
  endTime: Date,
  calendarId: string
) {
  const task = await getTaskById(taskId);

  // æ—¢ã« google_event_id ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯æ›´æ–°
  if (task.google_event_id) {
    console.log('æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°:', task.google_event_id);

    // Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°
    await updateCalendarEvent(
      task.google_event_id,
      {
        start: startTime,
        end: endTime,
        calendarId: calendarId
      }
    );

    // ã‚¿ã‚¹ã‚¯ã® scheduled_at, target_calendar_id ã‚’æ›´æ–°
    await updateTask(taskId, {
      scheduled_at: startTime.toISOString(),
      estimated_time: (endTime.getTime() - startTime.getTime()) / 60000,
      target_calendar_id: calendarId
    });

    return { action: 'updated', eventId: task.google_event_id };
  }

  // google_event_id ãŒãªã„å ´åˆã¯æ–°è¦ä½œæˆ
  console.log('æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ');
  const eventId = await createCalendarEvent({
    title: task.title,
    start: startTime,
    end: endTime,
    calendarId: calendarId
  });

  // google_event_id ã‚’ã‚¿ã‚¹ã‚¯ã«ä¿å­˜
  await updateTask(taskId, {
    scheduled_at: startTime.toISOString(),
    estimated_time: (endTime.getTime() - startTime.getTime()) / 60000,
    google_event_id: eventId,
    target_calendar_id: calendarId
  });

  return { action: 'created', eventId };
}
```

### 3.3 UI: æ—¢å­˜äºˆå®šã®ç¢ºèª

**ãƒ‰ãƒ­ãƒƒãƒ—æ™‚ã®æŒ™å‹•**:
```typescript
// ãƒ‰ãƒ­ãƒƒãƒ—ãƒãƒ³ãƒ‰ãƒ©
const handleDropTask = (taskId: string, dropTime: Date) => {
  const task = tasks.find(t => t.id === taskId);

  if (task.google_event_id) {
    // æ—¢ã«äºˆå®šãŒã‚ã‚‹å ´åˆã¯ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
    showConfirmDialog({
      title: 'æ—¢å­˜ã®äºˆå®šã‚’ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿ',
      message: `ã€Œ${task.title}ã€ã¯æ—¢ã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«äºˆå®šãŒã‚ã‚Šã¾ã™ã€‚\nç¾åœ¨: ${task.scheduled_at}\næ–°ã—ã„æ™‚é–“: ${dropTime}`,
      actions: [
        {
          label: 'ç§»å‹•',
          onClick: () => scheduleTask(taskId, dropTime, ...)
        },
        {
          label: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
          onClick: () => {}
        }
      ]
    });
  } else {
    // äºˆå®šãŒãªã„å ´åˆã¯ãã®ã¾ã¾ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    scheduleTask(taskId, dropTime, ...);
  }
};
```

### 3.4 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆæ™‚ã®å‹•ä½œ

**ã‚·ãƒŠãƒªã‚ª**: ã€Œä»•äº‹ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«äºˆå®šãŒã‚ã‚‹çŠ¶æ…‹ã§ã€ã€Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ãƒ‰ãƒ­ãƒƒãƒ—

```typescript
async function moveTaskToAnotherCalendar(
  taskId: string,
  newCalendarId: string,
  newStartTime: Date
) {
  const task = await getTaskById(taskId);

  if (task.google_event_id && task.target_calendar_id) {
    // å¤ã„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤
    await deleteCalendarEvent(
      task.target_calendar_id,
      task.google_event_id
    );

    // æ–°ã—ã„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ
    const newEventId = await createCalendarEvent({
      title: task.title,
      start: newStartTime,
      end: new Date(newStartTime.getTime() + task.estimated_time * 60000),
      calendarId: newCalendarId
    });

    // ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°
    await updateTask(taskId, {
      google_event_id: newEventId,
      target_calendar_id: newCalendarId,
      scheduled_at: newStartTime.toISOString()
    });

    return { moved: true, newEventId };
  }
}
```

---

## 4. å®Œå…¨åŒæ–¹å‘åŒæœŸ

### 4.1 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸Šã§ã®å¤‰æ›´ã‚’æ¤œçŸ¥

#### æ–¹æ³•1: Webhookã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼ˆæ¨å¥¨ï¼‰

**Google Calendar API: Push Notifications**
```typescript
// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®Webhookã‚’ç™»éŒ²
async function setupCalendarWebhook(userId: string, calendarId: string) {
  const { calendar } = await getCalendarClient(userId);

  const channelId = crypto.randomUUID();
  const expiration = Date.now() + 7 * 24 * 60 * 60 * 1000; // 7æ—¥é–“

  const response = await calendar.events.watch({
    calendarId: calendarId,
    requestBody: {
      id: channelId,
      type: 'web_hook',
      address: `${process.env.NEXTAUTH_URL}/api/calendar/webhook`,
      expiration: expiration.toString()
    }
  });

  // channelæƒ…å ±ã‚’ä¿å­˜
  await supabase.from('calendar_channels').insert({
    user_id: userId,
    channel_id: channelId,
    calendar_id: calendarId,
    resource_id: response.data.resourceId,
    expires_at: new Date(expiration)
  });

  return response.data;
}
```

**Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
```typescript
// POST /api/calendar/webhook
export async function POST(request: NextRequest) {
  const channelId = request.headers.get('X-Goog-Channel-ID');
  const resourceId = request.headers.get('X-Goog-Resource-ID');
  const state = request.headers.get('X-Goog-Resource-State'); // sync, exists, not_exists

  if (state === 'sync') {
    // åˆå›åŒæœŸç¢ºèª
    return new NextResponse('OK', { status: 200 });
  }

  // ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç‰¹å®š
  const { data: channel } = await supabase
    .from('calendar_channels')
    .select('*')
    .eq('channel_id', channelId)
    .single();

  if (!channel) {
    return new NextResponse('Channel not found', { status: 404 });
  }

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã—ã¦åŒæœŸ
  await syncCalendarEvents(channel.user_id, channel.calendar_id);

  return new NextResponse('OK', { status: 200 });
}
```

#### æ–¹æ³•2: ãƒãƒ¼ãƒªãƒ³ã‚°ï¼ˆWebhookãŒä½¿ãˆãªã„å ´åˆï¼‰

```typescript
// 30ç§’ã”ã¨ã«ãƒãƒ¼ãƒªãƒ³ã‚°
useEffect(() => {
  const interval = setInterval(async () => {
    await fetch('/api/calendar/sync-from-calendar', {
      method: 'POST',
      body: JSON.stringify({
        lastSyncedAt: lastSyncTime
      })
    });
  }, 30000);

  return () => clearInterval(interval);
}, []);
```

### 4.2 ã‚¤ãƒ™ãƒ³ãƒˆå¤‰æ›´ã®æ¤œçŸ¥ã¨åŒæœŸ

```typescript
// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆåŒæœŸ
async function syncCalendarEvents(userId: string, calendarId: string) {
  const { calendar } = await getCalendarClient(userId);
  const lastSyncedAt = await getLastSyncTime(userId, calendarId);

  // updatedMin ã§å·®åˆ†å–å¾—
  const response = await calendar.events.list({
    calendarId: calendarId,
    updatedMin: lastSyncedAt,
    singleEvents: true,
    orderBy: 'updated'
  });

  const events = response.data.items || [];

  for (const event of events) {
    // google_event_id ã§ã‚¿ã‚¹ã‚¯ã‚’æ¤œç´¢
    const { data: task } = await supabase
      .from('tasks')
      .select('*')
      .eq('google_event_id', event.id)
      .eq('user_id', userId)
      .single();

    if (task) {
      // ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯æ›´æ–°
      if (event.status === 'cancelled') {
        // ã‚¤ãƒ™ãƒ³ãƒˆãŒå‰Šé™¤ã•ã‚ŒãŸå ´åˆ
        await updateTask(task.id, {
          scheduled_at: null,
          google_event_id: null
        });

        // é€šçŸ¥: ã€Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®äºˆå®šãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€
        await notifyUser(userId, {
          type: 'calendar_event_deleted',
          taskTitle: task.title
        });
      } else {
        // ã‚¤ãƒ™ãƒ³ãƒˆãŒæ›´æ–°ã•ã‚ŒãŸå ´åˆ
        const startTime = new Date(event.start.dateTime || event.start.date);
        const endTime = new Date(event.end.dateTime || event.end.date);
        const duration = (endTime.getTime() - startTime.getTime()) / 60000;

        await updateTask(task.id, {
          scheduled_at: startTime.toISOString(),
          estimated_time: duration,
          title: event.summary || task.title // ã‚¿ã‚¤ãƒˆãƒ«ã‚‚åŒæœŸ
        });

        // é€šçŸ¥: ã€Œã‚¿ã‚¹ã‚¯ã®æ™‚é–“ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€
        await notifyUser(userId, {
          type: 'task_time_updated',
          taskTitle: task.title,
          newTime: startTime
        });
      }
    } else {
      // ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æ–°è¦ä½œæˆï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼‰
      if (event.status !== 'cancelled') {
        await createTaskFromEvent(event, userId, calendarId);

        // é€šçŸ¥: ã€Œæ–°ã—ã„äºˆå®šã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€
        await notifyUser(userId, {
          type: 'calendar_event_imported',
          eventTitle: event.summary
        });
      }
    }
  }

  // æœ€çµ‚åŒæœŸæ™‚åˆ»ã‚’æ›´æ–°
  await updateLastSyncTime(userId, calendarId, new Date());
}
```

### 4.3 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UIä¸Šã§ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ç·¨é›†

**react-big-calendar ã‚’ä½¿ç”¨**:
```typescript
import { Calendar, momentLocalizer } from 'react-big-calendar';
import moment from 'moment';

const localizer = momentLocalizer(moment);

function CalendarView() {
  const [events, setEvents] = useState([]);

  // ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆæ™‚é–“å¤‰æ›´ï¼‰
  const handleEventDrop = async ({ event, start, end }) => {
    // ã‚¿ã‚¹ã‚¯ã‚’æ¤œç´¢
    const task = tasks.find(t => t.google_event_id === event.id);

    if (task) {
      // ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°
      await updateTask(task.id, {
        scheduled_at: start.toISOString(),
        estimated_time: (end.getTime() - start.getTime()) / 60000
      });

      // Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æ›´æ–°
      await updateCalendarEvent(event.id, {
        start: start,
        end: end
      });

      // UIã‚’æ›´æ–°
      setEvents(prev => prev.map(e =>
        e.id === event.id ? { ...e, start, end } : e
      ));

      // é€šçŸ¥
      toast.success('äºˆå®šæ™‚é–“ã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
    }
  };

  // ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªã‚µã‚¤ã‚ºï¼ˆæ‰€è¦æ™‚é–“å¤‰æ›´ï¼‰
  const handleEventResize = async ({ event, start, end }) => {
    await handleEventDrop({ event, start, end });
  };

  return (
    <Calendar
      localizer={localizer}
      events={events}
      onEventDrop={handleEventDrop}
      onEventResize={handleEventResize}
      resizable
      draggableAccessor={() => true}
      style={{ height: '100%' }}
    />
  );
}
```

### 4.4 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥

**Supabase Realtime ã‚’ä½¿ç”¨**:
```typescript
// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚¿ã‚¹ã‚¯å¤‰æ›´ã‚’ç›£è¦–
useEffect(() => {
  const subscription = supabase
    .channel('tasks-changes')
    .on(
      'postgres_changes',
      {
        event: 'UPDATE',
        schema: 'public',
        table: 'tasks',
        filter: `user_id=eq.${userId}`
      },
      (payload) => {
        const updatedTask = payload.new;

        // UIã‚’æ›´æ–°
        setTasks(prev => prev.map(t =>
          t.id === updatedTask.id ? updatedTask : t
        ));

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ã‚‚æ›´æ–°
        if (updatedTask.scheduled_at) {
          updateCalendarView(updatedTask);
        }

        // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥
        toast.info(`ã€Œ${updatedTask.title}ã€ã®æ™‚é–“ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ`, {
          action: {
            label: 'ç¢ºèª',
            onClick: () => focusOnTask(updatedTask.id)
          }
        });
      }
    )
    .subscribe();

  return () => {
    subscription.unsubscribe();
  };
}, [userId]);
```

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆå®Œå…¨ç‰ˆï¼‰

### 5.1 tasks ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ‹¡å¼µç‰ˆï¼‰
```sql
ALTER TABLE tasks
  ADD COLUMN IF NOT EXISTS target_calendar_id TEXT DEFAULT 'primary',
  ADD COLUMN IF NOT EXISTS last_synced_at TIMESTAMP WITH TIME ZONE,
  ADD COLUMN IF NOT EXISTS sync_status TEXT DEFAULT 'synced'; -- 'synced', 'pending', 'error'

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰
CREATE INDEX IF NOT EXISTS idx_tasks_google_event_id ON tasks(google_event_id);
CREATE INDEX IF NOT EXISTS idx_tasks_scheduled_at ON tasks(scheduled_at);
CREATE INDEX IF NOT EXISTS idx_tasks_target_calendar ON tasks(target_calendar_id);
```

### 5.2 calendar_channels ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆWebhookç®¡ç†ï¼‰
```sql
CREATE TABLE IF NOT EXISTS calendar_channels (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users NOT NULL,
  channel_id TEXT NOT NULL UNIQUE,
  calendar_id TEXT NOT NULL,
  resource_id TEXT NOT NULL,
  expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  -- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  INDEX idx_calendar_channels_user_id (user_id),
  INDEX idx_calendar_channels_expires_at (expires_at)
);
```

### 5.3 sync_log ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆåŒæœŸå±¥æ­´ï¼‰
```sql
CREATE TABLE IF NOT EXISTS sync_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users NOT NULL,
  task_id UUID REFERENCES tasks ON DELETE SET NULL,
  google_event_id TEXT,
  calendar_id TEXT,
  action TEXT NOT NULL, -- 'create', 'update', 'delete', 'import'
  direction TEXT NOT NULL, -- 'to_calendar', 'from_calendar'
  status TEXT NOT NULL, -- 'success', 'error', 'conflict'
  error_message TEXT,
  changes JSONB, -- å¤‰æ›´å†…å®¹ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
  synced_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  -- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  INDEX idx_sync_log_user_id (user_id),
  INDEX idx_sync_log_task_id (task_id),
  INDEX idx_sync_log_synced_at (synced_at)
);
```

---

## 6. UI/UXãƒ•ãƒ­ãƒ¼ï¼ˆå®Œå…¨ç‰ˆï¼‰

### ãƒ•ãƒ­ãƒ¼1: è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¯¾å¿œã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼: å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºã‚’é¸æŠ
   [âœ“] ä»•äº‹  [âœ“] ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ  [ ] å®¶æ—
   â†“
2. UI: é¸æŠã•ã‚ŒãŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è‰²åˆ†ã‘ã§è¡¨ç¤º
   - ğŸŸ¦ ä»•äº‹ã®ã‚¤ãƒ™ãƒ³ãƒˆ
   - ğŸŸ£ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆ
   â†“
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼: MindMapã‹ã‚‰ã€Œè³‡æ–™ä½œæˆã€ã‚¿ã‚¹ã‚¯ã‚’ãƒ‰ãƒ©ãƒƒã‚°
   â†“
4. UI: ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸Šã«ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ã‚¨ãƒªã‚¢ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
   â†“
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼: ä»•äº‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æœˆæ›œ14:00ã«ãƒ‰ãƒ­ãƒƒãƒ—
   â†“
6. ã‚·ã‚¹ãƒ†ãƒ : google_event_id ã‚’ãƒã‚§ãƒƒã‚¯
   - å­˜åœ¨ã™ã‚‹ â†’ ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã€Œæ—¢å­˜ã®äºˆå®šã‚’ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿã€
   - å­˜åœ¨ã—ãªã„ â†’ ãã®ã¾ã¾æ–°è¦ä½œæˆ
   â†“
7. ã‚·ã‚¹ãƒ†ãƒ : ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã€Œä»•äº‹ã€ã«äºˆå®šã‚’ä½œæˆ
   - Google Calendar API: events.insert({ calendarId: 'primary' })
   - tasks.google_event_id = eventId
   - tasks.target_calendar_id = 'primary'
   â†“
8. UI: å³åº§ã«åæ˜ 
   - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ã«ğŸŸ¦ã€Œè³‡æ–™ä½œæˆ 14:00-16:00ã€è¡¨ç¤º
   - MindMapã®ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒ‰ã«é’ã„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³
   - ãƒˆãƒ¼ã‚¹ãƒˆ: ã€Œä»•äº‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«äºˆå®šã‚’è¿½åŠ ã—ã¾ã—ãŸã€
```

### ãƒ•ãƒ­ãƒ¼2: è¦ªã‚¿ã‚¹ã‚¯ã®ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼: è¦ªã‚¿ã‚¹ã‚¯ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨ˆç”»ã€ã‚’ãƒ‰ãƒ©ãƒƒã‚°
   - å­ã‚¿ã‚¹ã‚¯: è¦ä»¶å®šç¾©(2h), è¨­è¨ˆ(3h), å®Ÿè£…(5h)
   â†“
2. UI: ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã€ã€Œ3ä»¶ã®å­ã‚¿ã‚¹ã‚¯ã‚‚å«ã‚€ã€ãƒãƒƒã‚¸è¡¨ç¤º
   â†“
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æœˆæ›œ9:00ã«ãƒ‰ãƒ­ãƒƒãƒ—
   â†“
4. UI: ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨ˆç”»ã€ã¨ãã®å­ã‚¿ã‚¹ã‚¯3ä»¶ã‚’â”‚
   â”‚ 1/27(æœˆ) 9:00ã‹ã‚‰é †ç•ªã«äºˆå®šã—ã¾ã™ã€‚   â”‚
   â”‚                                      â”‚
   â”‚ äºˆå®šä¸€è¦§:                             â”‚
   â”‚ â”œâ”€ 9:00-11:00   è¦ä»¶å®šç¾© (2h)       â”‚
   â”‚ â”œâ”€ 11:00-14:00  è¨­è¨ˆ (3h)           â”‚
   â”‚ â””â”€ 14:00-19:00  å®Ÿè£… (5h)           â”‚
   â”‚                                      â”‚
   â”‚ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼: ğŸŸ¦ ä»•äº‹                  â”‚
   â”‚ [ ã‚­ãƒ£ãƒ³ã‚»ãƒ« ]         [ äºˆå®šè¨­å®š ]  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œäºˆå®šè¨­å®šã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
6. ã‚·ã‚¹ãƒ†ãƒ : å­ã‚¿ã‚¹ã‚¯ã‚’é †ç•ªã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
   - for each child:
     - Google Calendar API: events.insert()
     - tasks.google_event_id = eventId
     - tasks.scheduled_at = startTime
   â†“
7. UI: 3ä»¶ã®äºˆå®šãŒã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ä¸€æ°—ã«è¡¨ç¤ºã•ã‚Œã‚‹
   - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: 1ã¤ãšã¤é †ç•ªã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
   - ãƒˆãƒ¼ã‚¹ãƒˆ: ã€Œ3ä»¶ã®äºˆå®šã‚’è¿½åŠ ã—ã¾ã—ãŸã€
```

### ãƒ•ãƒ­ãƒ¼3: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸Šã§ã®æ™‚é–“å¤‰æ›´

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ã§ã€Œè³‡æ–™ä½œæˆ 14:00-16:00ã€ã‚’ãƒ‰ãƒ©ãƒƒã‚°
   â†“
2. UI: ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã€æ™‚é–“ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
   ã€Œ15:00-17:00ã€â† ãƒ‰ãƒ©ãƒƒã‚°å…ˆã®æ™‚é–“
   â†“
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼: 15:00ã®ä½ç½®ã§ãƒ‰ãƒ­ãƒƒãƒ—
   â†“
4. ã‚·ã‚¹ãƒ†ãƒ : åŒæ–¹å‘åŒæœŸé–‹å§‹
   a. ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°ï¼ˆSupabaseï¼‰
      - tasks.scheduled_at = '2026-01-27 15:00'
      - tasks.last_synced_at = NOW()

   b. Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æ›´æ–°
      - calendar.events.update({
          eventId: task.google_event_id,
          start: { dateTime: '2026-01-27T15:00:00+09:00' },
          end: { dateTime: '2026-01-27T17:00:00+09:00' }
        })

   c. MindMapã‚’æ›´æ–°ï¼ˆRealtimeçµŒç”±ï¼‰
      - Supabase Realtimeã§ã‚¿ã‚¹ã‚¯å¤‰æ›´ã‚’æ¤œçŸ¥
      - MindMapã®ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒ‰ã®è¡¨ç¤ºæ™‚åˆ»ã‚’æ›´æ–°
   â†“
5. UI: å…¨ç”»é¢ã§å³åº§ã«åæ˜ 
   - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼: æ–°ã—ã„æ™‚é–“ã«ç§»å‹•
   - MindMap: scheduled_at ãŒ 15:00 ã«æ›´æ–°
   - ãƒˆãƒ¼ã‚¹ãƒˆ: ã€Œäºˆå®šæ™‚é–“ã‚’ 15:00 ã«å¤‰æ›´ã—ã¾ã—ãŸã€
   â†“
6. ã‚·ã‚¹ãƒ†ãƒ : åŒæœŸãƒ­ã‚°ã‚’è¨˜éŒ²
   - sync_log ã«è¨˜éŒ²
     - action: 'update'
     - direction: 'from_calendar'
     - changes: { scheduled_at: { old: '14:00', new: '15:00' } }
```

### ãƒ•ãƒ­ãƒ¼4: Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å´ã§ã®å¤‰æ›´æ¤œçŸ¥

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼: Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã§ã€Œè³‡æ–™ä½œæˆã€ã®æ™‚é–“ã‚’å¤‰æ›´
   14:00-16:00 â†’ 16:00-18:00
   â†“
2. Google: Webhooké€šçŸ¥ã‚’é€ä¿¡
   POST /api/calendar/webhook
   â†“
3. ã‚·ã‚¹ãƒ†ãƒ : Webhookã‚’å—ä¿¡
   - channel_id ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç‰¹å®š
   - calendar.events.get() ã§æœ€æ–°æƒ…å ±ã‚’å–å¾—
   â†“
4. ã‚·ã‚¹ãƒ†ãƒ : google_event_id ã§ã‚¿ã‚¹ã‚¯ã‚’æ¤œç´¢
   - tasks.google_event_id = event.id ã§æ¤œç´¢
   â†“
5. ã‚·ã‚¹ãƒ†ãƒ : ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°
   - tasks.scheduled_at = '2026-01-27 16:00'
   - tasks.estimated_time = 120
   - tasks.last_synced_at = NOW()
   â†“
6. Supabase Realtime: ã‚¿ã‚¹ã‚¯å¤‰æ›´ã‚’ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
   â†“
7. UI: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åæ˜ ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒ—ãƒªã‚’é–‹ã„ã¦ã„ã‚‹å ´åˆï¼‰
   - MindMap: ã‚¿ã‚¹ã‚¯ã®æ™‚åˆ»è¡¨ç¤ºãŒ 16:00 ã«æ›´æ–°
   - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼: ã‚¤ãƒ™ãƒ³ãƒˆãŒ 16:00-18:00 ã«ç§»å‹•
   - ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥: ã€Œã€è³‡æ–™ä½œæˆã€ã®æ™‚é–“ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ (Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰åŒæœŸ)ã€
   â†“
8. ãƒ¦ãƒ¼ã‚¶ãƒ¼: é€šçŸ¥ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
9. UI: è©²å½“ã‚¿ã‚¹ã‚¯ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
   - MindMapã§ã‚¿ã‚¹ã‚¯ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
   - è©³ç´°ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º
```

---

## 7. æŠ€è¡“å®Ÿè£…è©³ç´°

### 7.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ
```
src/components/calendar/
â”œâ”€â”€ CalendarView.tsx          // ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ CalendarSelector.tsx      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é¸æŠUI
â”œâ”€â”€ EventCard.tsx             // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º
â”œâ”€â”€ TaskDropZone.tsx          // ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ã‚¨ãƒªã‚¢
â”œâ”€â”€ QuickScheduleModal.tsx    // ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«
â””â”€â”€ BulkScheduleDialog.tsx    // ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°

src/hooks/
â”œâ”€â”€ useCalendarSync.ts        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŒæœŸãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ useCalendarDragDrop.ts    // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†
â””â”€â”€ useRealtimeSync.ts        // RealtimeåŒæœŸ
```

#### useCalendarDragDrop.ts
```typescript
import { useDrag, useDrop } from 'react-dnd';

export function useCalendarDragDrop() {
  // ã‚¿ã‚¹ã‚¯ã‚’ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«ã™ã‚‹
  const [{ isDragging }, drag] = useDrag({
    type: 'TASK',
    item: (task: Task) => ({
      id: task.id,
      title: task.title,
      estimatedTime: task.estimated_time,
      hasChildren: task.has_children,
      childCount: task.child_count
    }),
    collect: (monitor) => ({
      isDragging: monitor.isDragging()
    })
  });

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã‚¿ã‚¤ãƒ ã‚¹ãƒ­ãƒƒãƒˆã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã«ã™ã‚‹
  const [{ isOver }, drop] = useDrop({
    accept: 'TASK',
    drop: async (item: DraggedTask, monitor) => {
      const dropPosition = monitor.getClientOffset();
      const dropTime = calculateDropTime(dropPosition);

      // è¦ªã‚¿ã‚¹ã‚¯ã®å ´åˆã¯ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
      if (item.hasChildren) {
        const confirmed = await showBulkScheduleDialog(item, dropTime);
        if (confirmed) {
          await scheduleTaskWithChildren(item.id, dropTime);
        }
      } else {
        await scheduleTask(item.id, dropTime);
      }
    },
    collect: (monitor) => ({
      isOver: monitor.isOver()
    })
  });

  return { drag, drop, isDragging, isOver };
}
```

### 7.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

#### API Routes

**1. GET /api/calendar/list** - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒªã‚¹ãƒˆå–å¾—
**2. GET /api/calendar/events** - ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—ï¼ˆè¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¯¾å¿œï¼‰
**3. POST /api/calendar/schedule-task** - ã‚¿ã‚¹ã‚¯ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆé‡è¤‡é˜²æ­¢æ©Ÿèƒ½ä»˜ãï¼‰
**4. POST /api/calendar/schedule-bulk** - è¦ªã‚¿ã‚¹ã‚¯ã®ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
**5. PUT /api/calendar/update-event** - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°
**6. POST /api/calendar/webhook** - Google Webhookå—ä¿¡
**7. POST /api/calendar/sync-from-calendar** - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼â†’ã‚¿ã‚¹ã‚¯åŒæœŸ

#### schedule-task APIï¼ˆé‡è¤‡é˜²æ­¢ä»˜ãï¼‰
```typescript
// POST /api/calendar/schedule-task
export async function POST(request: NextRequest) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  const {
    taskId,
    startTime,
    endTime,
    calendarId = 'primary'
  } = await request.json();

  // ã‚¿ã‚¹ã‚¯ã‚’å–å¾—
  const { data: task } = await supabase
    .from('tasks')
    .select('*')
    .eq('id', taskId)
    .single();

  const { calendar } = await getCalendarClient(user.id);

  // æ—¢ã« google_event_id ãŒã‚ã‚‹å ´åˆ
  if (task.google_event_id) {
    try {
      // æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°
      await calendar.events.update({
        calendarId: task.target_calendar_id || calendarId,
        eventId: task.google_event_id,
        requestBody: {
          summary: task.title,
          start: { dateTime: startTime },
          end: { dateTime: endTime }
        }
      });

      // ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°
      await supabase.from('tasks').update({
        scheduled_at: startTime,
        estimated_time: calculateDuration(startTime, endTime),
        target_calendar_id: calendarId,
        last_synced_at: new Date().toISOString(),
        sync_status: 'synced'
      }).eq('id', taskId);

      return NextResponse.json({
        action: 'updated',
        eventId: task.google_event_id
      });

    } catch (error) {
      // ã‚¤ãƒ™ãƒ³ãƒˆãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯æ–°è¦ä½œæˆ
      if (error.code === 404) {
        const newEventId = await createNewEvent();
        return NextResponse.json({
          action: 'recreated',
          eventId: newEventId
        });
      }
      throw error;
    }
  }

  // google_event_id ãŒãªã„å ´åˆã¯æ–°è¦ä½œæˆ
  const response = await calendar.events.insert({
    calendarId: calendarId,
    requestBody: {
      summary: task.title,
      start: { dateTime: startTime },
      end: { dateTime: endTime }
    }
  });

  const eventId = response.data.id;

  // ã‚¿ã‚¹ã‚¯ã« google_event_id ã‚’ä¿å­˜
  await supabase.from('tasks').update({
    google_event_id: eventId,
    scheduled_at: startTime,
    estimated_time: calculateDuration(startTime, endTime),
    target_calendar_id: calendarId,
    last_synced_at: new Date().toISOString(),
    sync_status: 'synced'
  }).eq('id', taskId);

  // åŒæœŸãƒ­ã‚°
  await supabase.from('sync_log').insert({
    user_id: user.id,
    task_id: taskId,
    google_event_id: eventId,
    calendar_id: calendarId,
    action: 'create',
    direction: 'to_calendar',
    status: 'success'
  });

  return NextResponse.json({
    action: 'created',
    eventId
  });
}
```

---

## 8. å®Ÿè£…å„ªå…ˆé †ä½

### Phase 2A: è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¯¾å¿œï¼ˆ2é€±é–“ï¼‰
1. âœ… GET /api/calendar/list å®Ÿè£…
2. âœ… CalendarSelector ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
3. âœ… tasks.target_calendar_id ã‚«ãƒ©ãƒ è¿½åŠ 
4. âœ… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆ¥è‰²åˆ†ã‘è¡¨ç¤º

### Phase 2B: é‡è¤‡é˜²æ­¢æ©Ÿèƒ½ï¼ˆ1é€±é–“ï¼‰
5. âœ… google_event_id ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯
6. âœ… æ—¢å­˜äºˆå®šã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
7. âœ… ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°å‡¦ç†

### Phase 2C: è¦ªã‚¿ã‚¹ã‚¯ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ2é€±é–“ï¼‰
8. âœ… POST /api/calendar/schedule-bulk å®Ÿè£…
9. âœ… å­ã‚¿ã‚¹ã‚¯å±•é–‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
10. âœ… BulkScheduleDialog ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### Phase 2D: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UIä¸Šã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆ2é€±é–“ï¼‰
11. âœ… react-big-calendar å°å…¥
12. âœ… ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ç·¨é›†
13. âœ… ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªã‚µã‚¤ã‚ºï¼ˆæ‰€è¦æ™‚é–“å¤‰æ›´ï¼‰

### Phase 2E: å®Œå…¨åŒæ–¹å‘åŒæœŸï¼ˆ3é€±é–“ï¼‰
14. âœ… POST /api/calendar/webhook å®Ÿè£…
15. âœ… Google Calendar Push Notificationsè¨­å®š
16. âœ… Supabase Realtimeçµ±åˆ
17. âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥UI

---

## 9. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### å˜ä½“ãƒ†ã‚¹ãƒˆ
- [ ] é‡è¤‡é˜²æ­¢ãƒ­ã‚¸ãƒƒã‚¯
- [ ] å­ã‚¿ã‚¹ã‚¯å±•é–‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- [ ] æ™‚é–“è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

### çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] ã‚¿ã‚¹ã‚¯â†’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŒæœŸ
- [ ] ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼â†’ã‚¿ã‚¹ã‚¯åŒæœŸ
- [ ] è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é–“ã®ç§»å‹•

### E2Eãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼
- [ ] è¦ªã‚¿ã‚¹ã‚¯ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
- [ ] Webhookå—ä¿¡â†’UIæ›´æ–°

---

## 10. ã¾ã¨ã‚

ã“ã®æ”¹è‰¯ç‰ˆè¨­è¨ˆã«ã‚ˆã‚Šã€Shikumikaã¯ä»¥ä¸‹ã®ä¾¡å€¤ã‚’æä¾›ã—ã¾ã™ï¼š

### âœ¨ æ–°æ©Ÿèƒ½
1. **è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¯¾å¿œ**: ä»•äº‹ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚’åˆ†ã‘ã¦ç®¡ç†
2. **è¦ªã‚¿ã‚¹ã‚¯ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**: å­ã‚¿ã‚¹ã‚¯ã‚‚å«ã‚ã¦ä¸€æ°—ã«äºˆå®šåŒ–
3. **é‡è¤‡é˜²æ­¢**: åŒã˜ã‚¿ã‚¹ã‚¯ã‚’2å›äºˆå®šã«å…¥ã‚Œãªã„å®‰å…¨æ©Ÿæ§‹
4. **å®Œå…¨åŒæ–¹å‘åŒæœŸ**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã®å¤‰æ›´ãŒã‚¿ã‚¹ã‚¯ã«å³åº§ã«åæ˜ 

### ğŸ¯ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾¡å€¤
- **åŠ¹ç‡çš„**: ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ç´ æ—©ãäºˆå®šè¨­å®š
- **æŸ”è»Ÿ**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ç”¨é€”åˆ¥ã«ç®¡ç†
- **å®‰å¿ƒ**: é‡è¤‡ã‚„ç«¶åˆã‚’è‡ªå‹•æ¤œçŸ¥
- **ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹**: ã©ã“ã§å¤‰æ›´ã—ã¦ã‚‚ã™ãã«åŒæœŸ

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: Phase 2Aã‹ã‚‰å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ã€‚
